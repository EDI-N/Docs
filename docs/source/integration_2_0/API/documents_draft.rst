##############
API Документы
##############

| **Сокращения и условные обозначения:**
| GLN - Global Location Number (глобальный номер местоположения)
| ИНН - Идентификационный номер налогоплательщика            
| КПП - Код причины постановки на учет в разных налоговых органах
| GTIN - Global Trade Item Number (штрих-код)               

--------------

.. contents:: Содержание:

--------------

Применяемые https-коды ответов сервера с API (intCode):

-  200 — OK
-  400 — Ошибка в параметрах запроса
-  401 — Не авторизован, в запросе отсутствует token
-  403 — Нет доступа к запрашиваемой информации
-  404 — Запрашиваемая информация не найдена
-  500 — Внутренняя ошибка сервера
-  501 — Метод не существует
-  503 — Сервис недоступен, техническое обслуживание, повторите запрос позже

Время жизни токена в случае бездействия пользователя - 10 минут. В ответ пользователь получает json пакет с https кодом.

API для работы с платформой **EDIN 2.0**. Запросы методов направляются на адрес https://edo-v2.edi-n.com . Передаваемые в cURL-запросе параметры являются обязательными, если не указано обратное (их опциональность).

-  Обмен данными происходит посредством запросов на сервер (в дальнейшем "API")
-  Обмен данными происходит в формате JSON
-  Возврат данных происходит в формате JSON
-  Передача изображений, печатных форм, неструкт. документов и подписей реализована в формате строки BASE64

--------------

**Проверки**
============

Проверка активности сервера:

.. code:: ruby

    curl -X GET 'https://edo-v2.edi-n.com/ping'

Проверка активности сессии:

.. code:: ruby

    curl -X GET 'https://edo-v2.edi-n.com/api/auth_check' -b 'SID=65daca25-74ba-4c85-8183-71b404a348c0;'

--------------

**Авторизация**
===============


+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------+
| **Метод запроса** |                                                                 HTTP POST                                                                  |                                                                  |
+===================+============================================================================================================================================+==================================================================+
| **Content-Type**  | application/json                                                                                                                           | тело запроса/ответа в json формате                               |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------+
| **cURL запроса**  | curl -X POST 'https://edo-v2.edi-n.com/api/oas/authorization' -d 'email=uaEDSsender&password=111&api_key=66B4814DEC28B4CA17DE56338A52D7DB' | **email** - строка; логин пользователя;                          |
|                   |                                                                                                                                            |                                                                  |
|                   |                                                                                                                                            | **password** - строка, пароль пользователя на платформе EDIN 2.0 |
|                   |                                                                                                                                            |                                                                  |
|                   |                                                                                                                                            | **api_key** - строка, пароль доступа к API                       |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------+


**Пример ответа:**

При успешной авторизации получаем в ответ "токен" ( ``'SID=65daca25-74ba-4c85-8183-71b404a348c0;'`` ) для дальнейшей работы:

.. code:: ruby

    пример отсутствует

--------------

**Поиск документов (с фильтрацией)**
====================================

+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **Метод запроса** |                                                                               HTTP POST                                                                               |                                                                                                                                     |
+===================+=======================================================================================================================================================================+=====================================================================================================================================+
| **Content-Type**  | application/json                                                                                                                                                      | тело запроса/ответа в json формате                                                                                                  |
+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **cURL запроса**  | curl -X POST 'https://edo-v2.edi-n.com/api/eds/docs/search?gln=9864065702429' -d {json с критериями поиска(Таблица_2_)} -b 'SID=458a0d38-5b56-4b8e-8998-009a1edd31eb' | **SID** - токен полученный при авторизации                                                                                          |
|                   |                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                       | **gln** - строка(13); номер GLN организации, которая связана с авторизированным пользователем платформы EDIN 2.0 на уровне аккаунта |
|                   |                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                       | {"…"} - тело запроса - json с критериями поиска                                                                                     |
+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+

.. toggle-header::
    :header: **Показать/Скрыть полный пример запроса**

        { 
            "direction": {
                "receiver": [
                    "9864065703464"
                ],
                "sender": [
                    "9864065702429"
                ],
                "type": "IN"
            },
            "statuses": [
                0
            ],
            "type":[
                {
                    "type" : 0
                }
            ],
            "limit":{
                "offset":"0",
                "count":"3"
            },
            "family":1,
            "number":"com222",
            "docDate":{
                "startTimestamp":"0",
                "finishTimestamp":"1505497243"
            },
            "docCreate":{
                "startTimestamp":"1505307243",
                "finishTimestamp":"1505497243"
            },
            "docRead":{
                "startTimestamp":"0",
                "finishTimestamp":"1505497243"
            },
            "docChanged":{
                "startTimestamp":"1505307243",
                "finishTimestamp":"1505497243"
            },
            "exchangeStatus":[]
        }


**Пример ответа:**

.. code:: ruby

    {
    "items": [],
    "totalCount": 0
}

--------------

**Получение контента документа**
================================

+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **Метод запроса** |                                                                                       HTTP GET                                                                                       |                                                                                                                                     |
+===================+======================================================================================================================================================================================+=====================================================================================================================================+
| **Content-Type**  | application/json                                                                                                                                                                     | тело запроса/ответа в json формате                                                                                                  |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **cURL запроса**  | curl -X GET 'https://edo-v2.edi-n.com/api/eds/doc/body?gln=9864065702429&doc_uuid=8c8a70e7-81c6-4382-8b58-7d60c3bc6ffd&body_type=JSON' -b 'SID=458a0d38-5b56-4b8e-8998-009a1edd31eb' | **gln** - строка(13); номер GLN организации, которая связана с авторизированным пользователем платформы EDIN 2.0 на уровне аккаунта |
|                   |                                                                                                                                                                                      |                                                                                                                                     |
|                   |                                                                                                                                                                                      | **doc_uuid** - строка; UUID документа                                                                                               |
|                   |                                                                                                                                                                                      |                                                                                                                                     |
|                   |                                                                                                                                                                                      | **body_type** - тип тела документа; возможные значения:                                                                             |
|                   |                                                                                                                                                                                      | -  ``CONTENT``: base64 контента без подписей/печатей                                                                                |
|                   |                                                                                                                                                                                      | -  ``JSON``: json документа                                                                                                         |
|                   |                                                                                                                                                                                      | -  ``SIGN``: base64 тело подписи                                                                                                    |
|                   |                                                                                                                                                                                      | -  ``STAMP``: base64 тело печати                                                                                                    |
|                   |                                                                                                                                                                                      | -  ``CRYPTED``: шифрованные исходные данные                                                                                         |
|                   |                                                                                                                                                                                      |                                                                                                                                     |
|                   |                                                                                                                                                                                      | **SID** - токен полученный при авторизации                                                                                          |
+-------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+





**Пример ответа:**

.. code:: ruby

    пример отсутствует

--------------


**Создание черновика документа**
================================

+-------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **Метод запроса** |                                                                                                                HTTP POST                                                                                                                 |                                                                                                                                     |
+===================+==========================================================================================================================================================================================================================================+=====================================================================================================================================+
| **Content-Type**  | application/json                                                                                                                                                                                                                         | тело запроса/ответа в json формате                                                                                                  |
+-------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **cURL запроса**  | curl -X POST 'https://edo-v2.edi-n.com/api/eds/doc?gln=9864065702429&doc_type=orders&doc_number=sdsd334&doc_date=1505497243&recipient=9864065702428&family=edi' -d {json - тело документа} -b 'SID=458a0d38-5b56-4b8e-8998-009a1edd31eb' | **gln** - строка(13); номер GLN организации, которая связана с авторизированным пользователем платформы EDIN 2.0 на уровне аккаунта |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **doc_type** - строка; конкретный тип документа                                                                                     |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **doc_number** - строка; номер документа                                                                                            |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **doc_date** - число; дата документа (в формате UNIX-timestamp)                                                                     |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **recipient** - строка(13); gln получателя                                                                                          |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **family** - строка; "группа" документов, возможные значения:                                                                       |
|                   |                                                                                                                                                                                                                                          | -  edi                                                                                                                              |
|                   |                                                                                                                                                                                                                                          | -  uzd                                                                                                                              |
|                   |                                                                                                                                                                                                                                          | -  reports                                                                                                                          |
|                   |                                                                                                                                                                                                                                          | -  certificats                                                                                                                      |
|                   |                                                                                                                                                                                                                                          | -  factoring                                                                                                                        |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | ["…"] - тело запроса - json документа                                                                                               |
|                   |                                                                                                                                                                                                                                          |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                          | **SID** - токен полученный при авторизации                                                                                          |
+-------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+

**Пример ответа:**

.. code:: ruby

    пример отсутствует

--------------


**Отправка черновика**
======================

+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **Метод запроса** |                                                                                                                                                         HTTP PATCH                                                                                                                                                          |                                                                                                                                     |
+===================+=============================================================================================================================================================================================================================================================================================================================+=====================================================================================================================================+
| **Content-Type**  | application/json                                                                                                                                                                                                                                                                                                            | тело запроса/ответа в json формате                                                                                                  |
+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **cURL запроса**  | curl -X PATCH 'https://edo-v2.edi-n.com/api/eds/doc/send?gln=9864065702429&doc_uuid=8c8a70e7-81c6-4382-8b58-7d60c3bc6ffd&doc_hash=704DD5F0A71FCB730D2B1AEA84FEE3FB&chain_hash=704DD5F0A71FCB730D2B1AEA84FEE3FB&chain_uuid=8c8a70e7-81c6-4382-8b58-7d60c3bc6ffd&partner_id=11' -b 'SID=458a0d38-5b56-4b8e-8998-009a1edd31eb' | **gln** - строка(13); номер GLN организации, которая связана с авторизированным пользователем платформы EDIN 2.0 на уровне аккаунта |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **doc_uuid** - строка; UUID документа                                                                                               |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **doc_hash** - строка; хэш документа                                                                                                |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **chain_hash** - строка; хэш цепочки                                                                                                |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **chain_uuid** - строка; ID цепочки                                                                                                 |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **partner_id** - число; ID ритейлера или 0 если не ритейлер                                                                         |
|                   |                                                                                                                                                                                                                                                                                                                             |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                                                                                                             | **SID** - токен полученный при авторизации                                                                                          |
+-------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+

**Пример ответа:**

.. code:: ruby

    пример отсутствует

--------------

**Получение списка цепочек документов**
=======================================

+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **Метод запроса** |                                                                                                               HTTP GET                                                                                                                |                                                                                                                                     |
+===================+=======================================================================================================================================================================================================================================+=====================================================================================================================================+
| **Content-Type**  | application/json                                                                                                                                                                                                                      | тело запроса/ответа в json формате                                                                                                  |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+
| **cURL запроса**  | curl -X GET 'https://edo-v2.edi-n.com/api/eds/chains?gln=9864065702429&type=inbox&limit_count=3&limit_offset=0&date_from=2018-01-01&date_to=2018-12-31&sender=9864065703464&family=edi' -b 'SID=458a0d38-5b56-4b8e-8998-009a1edd31eb' | **gln** - строка(13); номер GLN организации, которая связана с авторизированным пользователем платформы EDIN 2.0 на уровне аккаунта |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **type** - тип выборки; возможные значения:                                                                                         |
|                   |                                                                                                                                                                                                                                       | -  important                                                                                                                        |
|                   |                                                                                                                                                                                                                                       | -  inbox                                                                                                                            |
|                   |                                                                                                                                                                                                                                       | -  outbox                                                                                                                           |
|                   |                                                                                                                                                                                                                                       | -  archive                                                                                                                          |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **family** - "группа" документов, возможные значения:                                                                               |
|                   |                                                                                                                                                                                                                                       | -  edi                                                                                                                              |
|                   |                                                                                                                                                                                                                                       | -  uzd                                                                                                                              |
|                   |                                                                                                                                                                                                                                       | -  reports                                                                                                                          |
|                   |                                                                                                                                                                                                                                       | -  certificats                                                                                                                      |
|                   |                                                                                                                                                                                                                                       | -  factoring                                                                                                                        |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **SID** - токен полученный при авторизации                                                                                          |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | Опционально:                                                                                                                        |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **limit_count** - число; лимит выборки                                                                                              |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **date_from** - строка; дата с (в формате YYYY-MM-dd)                                                                               |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **date_to** - строка; дата по (в формате YYYY-MM-dd)                                                                                |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **limit_offset** - число; смещение относительно верхней границы выборки                                                             |
|                   |                                                                                                                                                                                                                                       |                                                                                                                                     |
|                   |                                                                                                                                                                                                                                       | **sender** - строка(13); gln отправителя                                                                                            |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------+

**Пример ответа:**

.. code:: ruby

    пример отсутствует

--------------

**Дополнения**
==============

.. _Таблица_2:

Таблица 2 - Таблица параметров (фильтр), которые передаются в json-формате в POST запросе метода **/api/eds/docs/search**, а также **api/eds/chains/search**

+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
|     |    Параметр     | Тип_ |                    Формат                    |                                                        Описание                                                         |
+=====+=================+======+==============================================+=========================================================================================================================+
| 1   | direction       | M    | direction {receiver[], sender[], type}       | указываются отправитель, получатель и связь между ними в критериях отбора документов                                    |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 2   | receiver        | M    | receiver ["..."]                             | массив GLN получателей - обязательный, но может быть пустым если указан массив GLN отправителей (sender)                |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 3   | sender          | M    | sender ["..."]                               | массив GLN отправителей, может быть пустым (если указан массив GLN получателей)                                         |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 4   | type            | M    | "EQ" / "OR" / "IN"                           | тип выборки; возможные значения:                                                                                        |
|     |                 |      |                                              | EQ - отбираются только документы в которых совпадают указанные И sender, И receiver                                     |
|     |                 |      |                                              | OR - отбираются документы в которых совпадают ИЛИ sender, ИЛИ receiver                                                  |
|     |                 |      |                                              | IN - отбираются документы в которых sender или receiver один из тех, которые указаны в массивах sender и receiver       |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 5   | statuses        | M    | statuses [ ]                                 | список статусов (состояний) документов, по которым будет происходить отбор:                                             |
|     |                 |      |                                              | 0 - все                                                                                                                 |
|     |                 |      |                                              | 1 - open                                                                                                                |
|     |                 |      |                                              | 2 - sent                                                                                                                |
|     |                 |      |                                              | 3 - delivered                                                                                                           |
|     |                 |      |                                              | 4 - inbox                                                                                                               |
|     |                 |      |                                              | 5 - read                                                                                                                |
|     |                 |      |                                              | 6 - error                                                                                                               |
|     |                 |      |                                              | 7 - deleted                                                                                                             |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 6   | type            | M    | type [ { } ]                                 | список типов документов:                                                                                                |
|     |                 |      |                                              | 0 - все типы                                                                                                            |
|     |                 |      |                                              | 1 / 2 / 3 ... и более - конкретный тип документа из [[doc_types>>doc:Tables.Exite_Tables.exite_main.doc_types.WebHome]] |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 7   | limit           | O    | limit {offset, count}                        | фильтр отбора                                                                                                           |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 8   | offset          | O    | int                                          | смещение относительно верхней границы выборки                                                                           |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 9   | count           | O    | int                                          | лимит выборки                                                                                                           |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 10  | family          | O    | 1 / 2 / 3 / 4 / 5                            | возможные значения (может отсутствовать):                                                                               |
|     |                 |      |                                              | 1 - edi                                                                                                                 |
|     |                 |      |                                              | 2 - uzd                                                                                                                 |
|     |                 |      |                                              | 3 - reports                                                                                                             |
|     |                 |      |                                              | 4 - certificats                                                                                                         |
|     |                 |      |                                              | 5 - factoring                                                                                                           |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 11  | number          | O    | String                                       | номер документа, можно не указывать в критериях отбора                                                                  |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 12  | docDate         | O    | docDate {startTimestamp, finishTimestamp}    | дата документа (в формате UNIX-timestamp) с / по, можно не указывать в критериях отбора                                 |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 13  | startTimestamp  | O    | String                                       | дата документа с                                                                                                        |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 14  | finishTimestamp | O    | String                                       | дата документа по                                                                                                       |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 15  | docCreate       | O    | docCreate {startTimestamp, finishTimestamp}  | дата создания документа (в формате UNIX-timestamp) с / по, можно не указывать в критериях отбора                        |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 18  | docRead         | O    | docRead {startTimestamp, finishTimestamp}    | дата прочтения документа (в формате UNIX-timestamp) с / по, можно не указывать в критериях отбора                       |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 21  | docChanged      | O    | docChanged {startTimestamp, finishTimestamp} | дата изменения документа (в формате UNIX-timestamp) с / по, можно не указывать в критериях отбора                       |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+
| 24  | exchangeStatus  | O    | int                                          | список состояний документооборота, может не указываться                                                                 |
+-----+-----------------+------+----------------------------------------------+-------------------------------------------------------------------------------------------------------------------------+

.. _Тип:

***Тип*** поля: **M** - mandatory (обязательное к заполнению), **O** - optional (опциональное)

--------------
