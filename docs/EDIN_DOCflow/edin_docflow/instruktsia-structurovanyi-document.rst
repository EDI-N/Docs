####################################################
Інструкція з налаштування структурованого документа 
####################################################	

Дана інструкція описує налаштування та порядок роботи з структурованим документом. 

-------------------------

.. |иконка-дата| image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_iconka_data.png
.. |иконка-кубик| image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_iconka_grid2.png

1 Авторизація в системі
------------------------
Для авторизації на платформі перейдіть за посиланням https://doc.edi-n.com/auth та введіть свої логін = email і пароль на формі авторизації. Детальна інформація з авторизації міститься в  `«Інструкції з авторизації»`_.

.. _«Інструкції з авторизації»: https://wiki.edi-n.com/ru/latest/services/EDIN_DOCflow/edin_docflow/instruktsia-avtorizatsia.html

2 Налаштування структурованого документа 
------------------------------------------
У межах документообігу EDIN-DOCflow, поряд із неструктурованими (звичайними) документами, реалізована можливість передачі структурованих (XML) документів у пакеті. Визначення типу документа як структурованого відбувається на етапі налаштування типів документів у межах компанії.   

Для налаштування структурованого документа перейдіть в меню «Налаштування компанії» – «Мої  компанії» та оберіть потрібну компанію зі списку, натиснувши на її назву. У формі редагування, що відкриється, перейдіть до вкладки «Документи». Вкладка містить вже закріплені за компанією типи документів. Для додання нового документа з ознакою «Структурований» натисніть на кнопку «Додати»: 

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_1.png
   :align: center

У формі додання типу документа заповніть обов’язкові поля: 

 - Назва – поле призначене для введення літер, цифр або спеціальних символів, мінімальна кількість знаків – три

 - Код - поле призначене для введення літер, цифр або спеціальних символів, мінімальна кількість знаків – один. Значення, введене в поле «Код», має бути унікальним у межах компанії. У разі введення значення, що вже використовується, система відобразить відповідне повідомлення. 

Наступним кроком встановіть відмітку напроти типу документа, а саме «Структурований», і натисніть «Зберегти»:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_2.png
   :align: center

Документ буде збережено та відображено в переліку типів документів з позначкою «Структурований» |иконка-кубик|:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_3.png
   :align: center

Для редагування назви або коду типу документа натисніть на його назву у загальному переліку, внесіть потрібні зміни та натисніть «Зберегти».

**2.1 Опис (налаштування) структури документа**
 
Для опису і зберігання структури документа використовується текстовий формат JSON. Параметри, що прописуються у налаштуваннях структури, визначають порядок відображення на web-формі елементів структури документа і правила їх заповнення.
 
При описі структурованого документа використовуються певні типи даних, кожен з яких є окремим типом елемента і описується у вигляді окремої структури зі своїм переліком параметрів, наприклад:

.. image:: pics_instruktsia-structurovanyi-document/json.png
   :align: center

Основні параметри, що використовуються при описі структурованого документа:

 - **id** — ідентифікатор елемента, назва елемента в документі XML

 - **title** — назва елемента на web-формі при заповненні документа

 - **readonly** (true / false) — визначає можливість редагування відповідного елемента структури

 - **attribute** (true / false) — при встановленому параметрі відповідний елемент є атрибутом в XML-файлі, при невстановленому — тегом

 - **optional** (true / false) — визначає обов'язковість заповнення поля

 - **type** — спеціальна секція для визначення типу елемента

 - **data** — спеціальна секція для визначення заповнення елемента певними значеннями, посиланнями на об'єкти плафторми, тощо

 - **fields** — спеціальна секція для опису масиву полів для типів елементів object і array

Типи даних (типи елемента) із параметрами, що застосовуються при описі структурованого документа:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_data.png
   :align: center
  
Структура секції data:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_data-section2.png
   :align: center

Для завантаження (внесення) опису структури документа натисніть на іконку «Структурований»:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_4.png
   :align: center

У формі, що відкриється, натисніть на кнопку «Додати»:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_5.png
   :align: center

Наступним кроком введіть опис структури документа у форматі JSON, оберіть кодування xml для документа і натисніть «Зберегти»:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_6.png
   :align: center

Система повідомить про успішне збереження відповідним повідомленням. Під час збереження опису структури відбувається перевірка валідності внесених даних на відповідність формату JSON та перевірка на дублі. 

Перевірка елементів структурованого документа при збереженні:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_validation2.png
   :align: center

У разі внесення не коректних даних кнопка «Зберегти» не активується. При внесенні дублюючого опису користувачеві буде відображене відповідне повідомлення. Перевірка на дублі виконується у межах компанії. 

Збереження опису структури відбувається по версіях створення. Номер версії присвоюється автоматично. Система також фіксує дату та час модифікації кожної версії. 

Під версією мається на увазі збереження певної модифікації опису структури. Система передбачає можливість роботи з різними модифікаціями одного типу документа за рахунок активації тієї чи іншої версії структури даних. Не активована схема зберігається у статусі «Чернетка». 

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_7.png
   :align: center

Схема у статусі «Чернетка» доступна для редагування. Для переходу у режим редагування натисніть на номер версії |иконка-дата|  або на кнопку «Редагувати». Для активації певної версії структури натисніть «Активувати» у формі редагування опису даних:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_8.png
   :align: center

Для зручності у формі додання версій реалізований пошук за номером і датою. Для старту пошуку введіть початкові символи у пошукове поле:  

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_9.png
   :align: center

.. admonition:: Зверніть увагу!

   У статусі «Активний» і «Чернетка» може бути лише одна версія структури. 

3 Налаштування зв’язку структурованого документа з типом пакета
----------------------------------------------------------------
Налаштування виконується на загальних підставах. Детальний опис процедури в пункті 8 `«Інструкції бізнес-адміністратора»`_.

.. _«Інструкції бізнес-адміністратора»: https://wiki.edi-n.com/ru/latest/services/EDIN_DOCflow/edin_docflow/instruktsia-biznes-administratora.html

4 Заповнення структурованого документа
---------------------------------------- 
Форма заповнення структури відкривається при доданні документа з ознакою «структурований» до пакета. Для цього перейдіть в меню «Пакети», вкладка «Документи», і натисніть «Додати»:

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_10.png
   :align: center

Після цього відкриється форма для заповнення структурованого документа, складена відповідно до опису його структури. 

Елементи структури документа відображаються послідовно, у порядку, заданому в налаштуваннях структури. При цьому типи елемента (секції) відображаються у вигляді окремих структур, складові компоненти яких розташовуються горизонтально по три в ряд. Назва структури (типу елемента) виділяється жирним шрифтом:  

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_11.png
   :align: center

Заповніть поля документа і натисніть кнопку «Зберегти». Для повторного перегляду збереженого структурованого документа в пакеті натисніть на іконку |иконка-кубик| напроти документа: 

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_12.png
   :align: center

5 Блокування типу документа
-----------------------------
Для блокування типу документа оберіть потрібний тип з переліку закріплених  за компанією, меню «Налаштування компанії» – «Мої компанії» – «Документи», та  переведіть перемикач у положення «Заблокувати»:  

.. image:: pics_instruktsia-structurovanyi-document/instr_struct_doc_13.png
   :align: center

Тип документа буде переведений у статус «Заблокований». Даний статус блокує використання типу документа у будь-яких операціях з моменту призначення статусу. 
